# Copilot Instructions

## プロジェクト概要

パレ学マスター - パレデミア学園に関するクイズゲーム

## 参照すべきドキュメント

- `docs/内部仕様書.txt` - 設計仕様・コンポーネント仕様
- `docs/デザインガイドライン.txt` - デザインコンセプト・スタイル規約
- `docs/TODO.md` - タスク管理

## 開発手順

※Agentモードで実行されることを想定

1. チャット内容をもとに、TODO.md から実行するべきタスクを把握
2. 既存の実装内容を確認
3. 実装内容を簡潔にまとめてチャットに出力し、必要に応じて質問
4. 人間から許可を得てから実装を開始（「進めて」「実装して」等の明確な許可がない限り実装しない）
5. (人間がやる)シンプルブラウザで動作確認し、問題があるならスクショなどを提供
6. 必要に応じて修正を行う(まだ問題があるなら5へ、人間が「LGTM」と発言したら7へ)
7. ユニットテストの作成と実行(必要に応じて)
8. `docs/内部仕様書.txt` の内容を必要に応じて更新（ディレクトリ構成、型定義、コンポーネント仕様など）
9. 人間が「done」と発言したら、`docs/TODO.md` の該当タスクを完了済みに更新し、コミット

## コーディングルール

### 命名規則

| 対象 | 規則 | 例 |
|-----|------|-----|
| TypeScript変数・関数・プロパティ | camelCase | `currentIndex`, `selectAnswer()` |
| TypeScript型・インターフェース | PascalCase | `ProcessedQuestion`, `GameState` |
| JSONフィールド | snake_case | `sort_answers`, `source_url` |
| CSSクラス（Tailwind以外） | kebab-case | `game-container` |
| 定数（変更されない値） | UPPER_SNAKE_CASE | `MAX_QUESTIONS` |

### 必須

- TypeScript の型インポートには `import type` を使用する
- コンポーネントは関数コンポーネントで記述
- 状態管理は Zustand の `gameStore` を使用
- スタイリングは Tailwind CSS を使用
  - 原則としてインラインスタイルは避ける
  - **例外**: `min(Xvw, Xvh)` を使ったレスポンシブサイズ指定はインラインスタイルを使用する（Tailwindでは表現できないため）

## なるべく守ってほしいこと

- 保守しやすい状態を保つこと
  - DRY原則を守るなど、一般的なベストプラクティスに従うこと
  - コード変更時は影響範囲を考慮すること
- 可読性の高いコードを書くこと
  - 適切な変数名、関数名を使用すること
  - コメントを適切に追加すること
  - 実装を変更したときはコメントも更新すること
  - コメントで過去の実装に言及しないこと
- ドキュメントは現在の状態のみを記述すること
  - 過去の実装や変更履歴への言及は不要
- 変更点は最小限に抑えること
- ロジック部分はユニットテストを作成すること

## 禁止事項

- 指示にない実装や変更や装飾
- `any` 型の使用
- `var` の使用（`const` / `let` を使う）
- クラスコンポーネントの使用

## スタイリングのベストプラクティス

### レスポンシブサイズ指定

本プロジェクトでは 4:3 アスペクト比のゲームコンテナを採用し、CSS Container Queries の `cqmin` 単位を使用する。

**GameContainer の仕様:**
- 横長画面: 高さ = 100vh、幅 = 133.33vh
- 縦長画面: 幅 = 100vw、高さ = 75vw、上部配置
- `container-type: size` が設定されており、子要素で `cqmin` 単位が使用可能

**cqmin 単位について:**
- コンテナの幅と高さの小さい方に対する割合
- `3cqmin` = コンテナの短辺の 3%
- ビューポートサイズに依存せず、ゲームコンテナ内で一貫したサイズを保証

| 用途 | 推奨 | 例 |
|------|------|----|
| フォントサイズ | `Xcqmin` | `style={{ fontSize: '3cqmin' }}` |
| パディング・マージン | `Xcqmin` | `style={{ padding: '1cqmin 2cqmin' }}` |
| 要素のギャップ | `Xcqmin` または Tailwind `gap-[Xcqmin]` | `style={{ gap: '2cqmin' }}` |
| 要素の高さ・幅（親要素比率） | パーセンテージ | `style={{ height: '40%' }}` |

### Tailwind vs インラインスタイル

- **Tailwind任意値（`gap-[3cqmin]` など）**: Container Query 単位は Tailwind の任意値でも使用可能
- **確実に余白を確保したい場合**: `cqmin` をインラインスタイルで指定する
- **CSS Grid のギャップ**: `style` 属性または Tailwind の `gap-x-[]`, `gap-y-[]` クラスを使用する

## 動作確認用データの使用方法

特定の問題やデータで動作確認が必要な場合、本番データ（`questions.json`）を直接編集せず、以下の手順で行う：

1. `public/data/questions_dev.json` に動作確認用のデータを作成
2. `src/config.ts` の `DEV_MODE` を `true` に設定
3. 動作確認を実施
4. 動作確認完了後、`DEV_MODE` を `false` に戻す

この方法により、本番データを変更せずに動作確認ができる。

## 保守作業

「保守作業」と指示されたら、以下の作業を順番に実行する：

### 1. コード品質チェック
- ESLint を実行してエラー・警告を確認・修正
- TypeScript の型エラーを確認・修正
- コメントと実装の乖離がないか確認・修正
- コードの冗長性や重複を確認・修正
- 保守性の悪い箇所を確認・修正

### 2. 依存関係の確認
- `pnpm outdated` で古いパッケージを確認
- セキュリティ上の問題がある依存関係を報告

### 3. テストの実行
- ユニットテストを実行し、失敗があれば修正

### 4. ドキュメントの整合性確認
- 内部仕様書.txt と実際のコードの整合性を確認
- 乖離があれば現在の実装を真とし、内部仕様書.txt を更新

### 5. TODO.md の整合性確認
- タスクの完了・未完了ステータスと実際のコードの状態を照合
- 実装済みなのに未完了のタスク、または未実装なのに完了済みのタスクがあれば報告

### 6. 結果報告
- 発見した問題と修正内容をまとめて報告

## 継続的改善

copilot-instructions.md の不備が原因で指摘を受けた場合は、同様の問題が再発しないよう copilot-instructions.md を改善すること。
